<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS: S√∂zc√ºk Operasyonu - Tam Liste</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Chakra+Petch:wght@400;600;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* CS2 Theme Colors */
        :root {
            --cs-orange: #de9b35;
            --cs-dark: #0d1116;
            --cs-gray: #1b1f27;
            --cs-text: #b8b8b8;
        }

        body { 
            font-family: 'Rajdhani', sans-serif; 
            background-color: var(--cs-dark); 
            color: #fff; 
            background-image: radial-gradient(circle at 50% 50%, #1f232a 0%, #0d1116 100%);
        }
        
        h1, h2, h3, .tactical-font { font-family: 'Black Ops One', cursive; letter-spacing: 1px; }
        .hud-font { font-family: 'Chakra Petch', sans-serif; }
        
        /* Level Card Styles */
        .level-card { 
            background: linear-gradient(90deg, rgba(30,35,45,0.9) 0%, rgba(20,25,35,0.8) 100%);
            border-left: 4px solid #333;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        .level-card:hover { 
            transform: translateX(5px); 
            background: rgba(45,50,60,0.9);
            border-left-color: var(--cs-orange);
            box-shadow: -5px 0 15px rgba(222, 155, 53, 0.2); 
        }

        /* Aktif G√∂rev Animasyonu */
        .current-mission {
            border-left-color: #fbbf24 !important; /* Amber-400 */
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.1) 0%, rgba(20,25,35,0.8) 100%) !important;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.15);
        }
        .next-badge {
            animation: pulse-badge 2s infinite;
        }
        @keyframes pulse-badge {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0d1116; }
        ::-webkit-scrollbar-thumb { background: var(--cs-orange); }

        /* Scanline Animation */
        .scanline {
            width: 100%; height: 2px; z-index: 10;
            background: rgba(222, 155, 53, 0.1);
            position: absolute; top: 0;
            animation: scan 3s linear infinite;
            pointer-events: none;
        }
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        .hidden { display: none !important; }
        .login-box { z-index: 50; position: relative; }
        
        /* CS Button Style */
        .cs-btn {
            background: linear-gradient(180deg, #de9b35 0%, #b07015 100%);
            border: 1px solid #ffbf60;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 0 #7a4a0a;
            transition: all 0.1s;
        }
        .cs-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #7a4a0a;
        }
        
        /* Gmail Button Special Style */
        .gmail-btn {
            background: linear-gradient(180deg, #D44638 0%, #B23121 100%);
            border: 1px solid #E57373;
            box-shadow: 0 4px 0 #8B2515;
        }
        .gmail-btn:active {
            box-shadow: 0 0 0 #8B2515;
        }

        /* Recorder Animation */
        .recording-pulse {
            animation: pulse-red 1.5s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* --- MODAL VE TABLO STƒ∞LLERƒ∞ --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 100; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        .modal-content {
            background: #14171f; border: 1px solid #de9b35; width: 95%; max-width: 600px;
            max-height: 85vh; overflow-y: auto; position: relative;
            box-shadow: 0 0 50px rgba(222, 155, 53, 0.15);
            transform: scale(0.95); transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        
        /* √ñzel Tebrik Modalƒ± */
        .congrats-modal {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border: 2px solid #fbbf24;
            text-align: center;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(251, 191, 36, 0.3);
            transform: scale(0.9); transition: transform 0.3s;
        }
        .modal-overlay.active .congrats-modal { transform: scale(1); }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden selection:bg-orange-500 selection:text-white">

    <div class="scanline"></div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="flex items-center justify-center min-h-screen p-4 bg-[url('https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/clans/3381077/89e57849206d445348981440e74f329971936c64.png')] bg-cover bg-center">
        <div class="absolute inset-0 bg-gray-900/90 backdrop-blur-sm z-0"></div>
        
        <div class="login-box bg-gray-800/95 p-8 border border-gray-600 shadow-[0_0_50px_rgba(0,0,0,0.8)] max-w-md w-full text-center relative overflow-hidden">
            <!-- Decorative Corner -->
            <div class="absolute top-0 right-0 w-16 h-16 border-t-4 border-r-4 border-orange-500"></div>
            <div class="absolute bottom-0 left-0 w-16 h-16 border-b-4 border-l-4 border-orange-500"></div>

            <div class="mb-6 relative">
                <i class="fas fa-crosshairs text-6xl text-orange-500 animate-spin-slow" style="animation-duration: 10s;"></i>
                <i class="fas fa-user-secret absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl text-white"></i>
            </div>
            <h1 class="text-4xl text-white mb-1 tracking-widest uppercase italic">CS: S√ñZC√úK</h1>
            <h2 class="text-2xl text-orange-500 mb-6 tracking-widest uppercase">Hƒ∞KAYE OPERASYONU</h2>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-orange-400 mb-1 tracking-wider uppercase"><i class="fas fa-id-card mr-1"></i> Operat√∂r Adƒ±</label>
                    <input type="text" id="player-name" class="w-full bg-gray-900 border border-gray-600 p-3 text-white focus:outline-none focus:border-orange-500 transition font-mono" placeholder="√ñrn: Aybars">
                </div>
            </div>

            <button type="button" onclick="startGame()" class="mt-8 w-full cs-btn text-white font-bold py-4 text-lg group cursor-pointer">
                OPERASYONU BA≈ûLAT <i class="fas fa-angle-double-right ml-2 group-hover:translate-x-1 transition"></i>
            </button>
            
            <!-- ƒ∞MZA ALANI -->
            <div class="mt-8 border-t border-gray-700 pt-4">
                <p class="text-[10px] text-gray-500 font-mono tracking-widest uppercase opacity-70">
                    HAZIRLAYAN VE KONTROL EDENLER: <br> 
                    <span class="text-orange-600 font-bold">stj.dkt.Mehmet Hanefi Bulduk</span><br>
                    <span class="text-orange-600 font-bold">stj.dkt.Zeynep Akdaƒü</span><br>
                    <span class="text-orange-600 font-bold">stj.dkt.Zeynep Sƒ±la Mutlu</span>
                </p>
            </div>
        </div>
    </div>

    <!-- TEBRƒ∞K MODALI (SADECE ƒ∞LK Gƒ∞Rƒ∞≈ûTE) -->
    <div id="welcome-modal" class="modal-overlay hidden">
        <div class="congrats-modal max-w-lg mx-auto">
            <i class="fas fa-trophy text-6xl text-yellow-400 mb-4 animate-bounce"></i>
            <h2 class="text-3xl font-bold text-white mb-2 tactical-font">TEBRƒ∞KLER AJAN <span id="modal-agent-name" class="text-orange-500"></span>!</h2>
            <p class="text-gray-300 mb-6 font-mono text-lg">
                √ñnceki haftalardaki b√ºt√ºn zorlu g√∂revleri ba≈üarƒ±yla tamamladƒ±n.<br>
                ≈ûimdi <b>Hƒ∞KAYE MODU</b>'na ge√ßi≈ü yapƒ±yorsun.<br><br>
                Bu operasyonun kahramanƒ± sensin! üéñÔ∏è<br>
                Bundan sonra biraz farklƒ± √ßalƒ±≈üacaƒüƒ±z
            </p>
            <button onclick="closeWelcomeModal()" class="cs-btn px-8 py-3 text-white font-bold rounded shadow-lg hover:scale-105 transition">
                G√ñREVE DEVAM ET
            </button>
        </div>
    </div>

    <!-- GAME DASHBOARD -->
    <div id="game-dashboard" class="hidden min-h-screen bg-[#0d1116] pb-20">
        
        <!-- HUD / Header -->
        <header class="bg-[#1b1f27] border-b border-orange-900/30 sticky top-0 z-40 shadow-lg">
            <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                
                <!-- Player Info -->
                <div class="flex items-center gap-4">
                    <div class="relative group">
                        <img src="https://raw.githubusercontent.com/SteamDatabase/GameTracking-CSGO/master/csgo/pak01_dir/resource/flash/econ/characters/tm_phoenix_varianta.png" 
                             class="w-16 h-16 object-contain drop-shadow-[0_0_10px_rgba(255,255,255,0.2)]">
                    </div>
                    <div>
                        <h2 id="display-name" class="font-bold text-xl leading-tight text-white hud-font tracking-wide">OPERATOR</h2>
                        <div class="text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-1">GLOBAL ELITE</div>
                        <div class="flex items-center gap-3 text-xs text-gray-400 font-mono">
                            <span class="bg-gray-800 border border-gray-600 px-2 py-0.5 text-orange-400"><i class="fas fa-book-open"></i> Hƒ∞KAYE MODU</span>
                        </div>
                    </div>
                </div>

                <!-- XP Bar -->
                <div class="flex flex-col items-end w-1/3">
                    <div class="flex justify-between w-full text-xs mb-1 font-mono uppercase">
                        <span class="text-orange-500 font-bold">Tamamlanan</span>
                        <span id="xp-display" class="text-white">0 / 7</span>
                    </div>
                    <div class="w-full bg-gray-800 h-3 border border-gray-600 skew-x-[-15deg]">
                        <div id="xp-bar" class="bg-gradient-to-r from-orange-600 to-yellow-400 h-full transition-all duration-1000 shadow-[0_0_10px_#de9b35]" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-4 py-8">
            
            <!-- Tek Ba≈ülƒ±k -->
            <div class="mb-6 border-l-4 border-orange-500 pl-4 bg-gray-800/50 p-4 rounded-r">
                <h3 class="text-2xl font-black text-white italic uppercase tactical-font tracking-wider">OPERASYON G√ñREV Lƒ∞STESƒ∞</h3>
                <p class="text-gray-400 font-mono text-sm">7 adet gizli hikaye dosyasƒ±. Hepsini sƒ±rayla tamamla.</p>
            </div>

            <!-- Content Area (Tek Liste) -->
            <div id="content-area" class="space-y-4">
                <!-- Javascript ile doldurulacak -->
            </div>

            <!-- Footer / Exit -->
            <div class="mt-12 text-center space-y-4">
                <button onclick="resetProgress()" class="text-xs text-red-500 hover:text-red-400 hover:underline uppercase tracking-widest p-2 border border-red-900/30 bg-red-900/10">
                    <i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü Yap / Sƒ±fƒ±rla
                </button>
                
                <div class="pt-6 border-t border-gray-800 opacity-50 hover:opacity-100 transition">
                    <i class="fas fa-shield-alt text-orange-600 mb-2 text-xl"></i>
                    <p class="text-[10px] text-gray-400 font-mono">
                        HAZIRLAYAN VE KONTROL EDENLER: <br> 
                        <span class="text-orange-500 font-bold">stj.dkt.Mehmet Hanefi Bulduk</span><br>
                        <span class="text-orange-600 font-bold">stj.dkt.Zeynep Akdaƒü</span><br>
                        <span class="text-orange-600 font-bold">stj.dkt.Zeynep Sƒ±la Mutlu</span>
                    </p>
                </div>
            </div>
            <div class="h-20"></div>
        </main>
    </div>

    <!-- Hƒ∞KAYE MODALI -->
    <div id="mission-modal" class="modal-overlay">
        <div class="modal-content">
            <!-- Ba≈ülƒ±k -->
            <div class="bg-[#0d1116] p-4 border-b border-gray-700 flex justify-between items-center sticky top-0 z-20">
                <div class="flex items-center gap-3">
                    <i class="fas fa-book-reader text-orange-500 text-xl"></i>
                    <div>
                        <h3 id="modal-title" class="text-white font-bold tactical-font text-lg">Hƒ∞KAYE</h3>
                    </div>
                </div>
                <button onclick="closeModal()" class="text-gray-500 hover:text-white transition"><i class="fas fa-times text-2xl"></i></button>
            </div>

            <!-- ƒ∞√ßerik -->
            <div class="p-4" id="modal-body-content">
                <!-- JS ile doldurulacak -->
            </div>

            <!-- SES KAYDI VE OYNATICI ALANI -->
            <div id="audio-recorder-area" class="px-4 pb-4 border-t border-gray-800 bg-[#0f1218]">
                <div class="flex items-center justify-between mt-3">
                    <button id="record-btn" onclick="toggleRecording()" class="w-full bg-red-900/50 hover:bg-red-800 text-red-200 border border-red-700 rounded py-2 px-4 flex items-center justify-center gap-2 transition">
                        <i class="fas fa-microphone"></i> <span id="record-text">SES KAYDI BA≈ûLAT</span>
                    </button>
                </div>
                <!-- ƒ∞ndirme Linki (Gizli Ba≈ülar) -->
                <a id="download-link" class="hidden w-full mt-2 bg-blue-900/50 hover:bg-blue-800 text-blue-200 border border-blue-700 rounded py-2 px-4 text-center transition cursor-pointer font-bold text-xs tracking-wider flex items-center justify-center gap-2" download="kayit.mp3">
                    <i class="fas fa-download"></i> KAYDI ƒ∞NDƒ∞R (MAƒ∞LE EKLEMEK ƒ∞√áƒ∞N)
                </a>
                <div id="audio-player-container" class="mt-3 hidden">
                    <audio id="audio-player" controls class="w-full h-8"></audio>
                </div>
            </div>

            <!-- Alt Butonlar -->
            <div class="p-4 border-t border-gray-700 bg-[#0d1116] flex flex-col md:flex-row justify-end gap-3 sticky bottom-0">
                <button onclick="closeModal()" class="px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white uppercase tracking-wider order-3 md:order-1">ƒ∞ptal</button>
                
                <!-- GMAIL BUTONU -->
                <button onclick="submitMissionReport('gmail')" class="cs-btn gmail-btn px-4 py-2 text-white font-bold text-xs rounded shadow-lg hover:brightness-110 flex items-center justify-center gap-2 order-1 md:order-2">
                    <i class="fab fa-google"></i> GMAIL ƒ∞LE G√ñNDER
                </button>

                <!-- VARSAYILAN MAIL UYGULAMASI -->
                <button onclick="submitMissionReport('mailto')" class="cs-btn px-4 py-2 text-white font-bold text-xs rounded shadow-lg hover:brightness-110 flex items-center justify-center gap-2 order-2 md:order-3">
                    <i class="fas fa-envelope"></i> UYGULAMA ƒ∞LE G√ñNDER
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- Hƒ∞KAYE VERƒ∞LERƒ∞ (SIRALI) ---
        const storyList = [
            {
                id: "s1",
                title: "1. Uzay Gezgini Zeki",
                text: "Zeki, uzay aracƒ±nƒ±n hƒ±zƒ±nƒ± biraz artƒ±rdƒ±. G√∂zlerini yƒ±ldƒ±zlara dikmi≈ü, gizemli bir gezegene doƒüru ilerliyordu. Cihazƒ±n ekranƒ±ndaki yazƒ±lar hƒ±zla deƒüi≈üiyordu. Zeki, bu ƒ±ssƒ±z yolculukta yalnƒ±z deƒüildi; yanƒ±nda en sadƒ±k dostu robot Zƒ±pzƒ±p vardƒ±. Zƒ±pzƒ±p, nazik√ße bipleyerek yakƒ±tƒ±n azaldƒ±ƒüƒ±nƒ± haber verdi.",
                icon: "rocket"
            },
            {
                id: "s2",
                title: "2. Terzi Rƒ±za‚Äônƒ±n Maƒüazasƒ±",
                text: "Terzi Rƒ±za, pazartesi sabahƒ± maƒüazasƒ±nƒ± erkenden a√ßtƒ±. Tezg√¢hƒ±n √ºzerinde mavi bir kazak ve beyaz bir pantolon duruyordu. Rƒ±za, makasƒ±nƒ± eline aldƒ± ve kuma≈üƒ± √∂zenle kesti. M√º≈üterisi Aziz Bey, sipari≈üinin hazƒ±r olup olmadƒ±ƒüƒ±nƒ± sormak i√ßin gelmi≈üti. Rƒ±za, g√ºler y√ºzle 'Az kaldƒ±, birazdan biter,' dedi.",
                icon: "cut"
            },
            {
                id: "s3",
                title: "3. Deniz Kenarƒ±nda Gezi",
                text: "Deniz kƒ±yƒ±sƒ±nda gezintiye √ßƒ±kan √ñzlem, tuzlu suyun kokusunu i√ßine √ßekti. Dalgalar kayalara vururken √ßƒ±kardƒ±ƒüƒ± ses, kulaƒüƒ±na m√ºzik gibi geliyordu. √ñzlem, kumlarƒ±n √ºzerinde y√ºr√ºrken parlayan bir deniz yƒ±ldƒ±zƒ± buldu. Hemen eƒüilip onu nazik√ße suya geri bƒ±raktƒ±. Doƒüanƒ±n bu e≈üsiz g√ºzelliƒüi onu √ßok mutlu etmi≈üti.",
                icon: "water"
            },
            {
                id: "s4",
                title: "4. Z√ºrafa Zuzu‚Äônun Doƒüum G√ºn√º",
                text: "Z√ºrafa Zuzu, sekizinci ya≈ü g√ºn√º i√ßin b√ºy√ºk bir hazƒ±rlƒ±k yapƒ±yordu. Z√ºrafalarƒ±n en uzunu olduƒüu i√ßin balonlarƒ± aƒüa√ßlarƒ±n en √ºst dalƒ±na asabiliyordu. Arkada≈üƒ± zebra, taze sebzelerden g√ºzel bir salata hazƒ±rladƒ±. Zuzu, arkada≈ülarƒ±nƒ±n nazik s√ºrprizi kar≈üƒ±sƒ±nda heyecanƒ±nƒ± gizleyemedi ve ne≈üeyle zƒ±pladƒ±.",
                icon: "birthday-cake"
            },
            {
                id: "s5",
                title: "5. M√ºzede Bir G√ºn",
                text: "Okul gezisinde m√ºzeye giden Ozan, eski zamanlardan kalma eserleri inceledi. √ñzellikle tun√ßtan yapƒ±lmƒ±≈ü vazolar ve paslanmƒ±≈ü zincirler ilgisini √ßekti. M√ºze g√∂revlisi, eserlerin titizlikle korunmasƒ± gerektiƒüini anlattƒ±. Ozan, bu ziyaret sayesinde ge√ßmi≈üin izlerini daha yakƒ±ndan tanƒ±ma ≈üansƒ± buldu.",
                icon: "landmark"
            },
            {
                id: "s6",
                title: "6. Yaz Tatili ve Meyveler",
                text: "Yaz mevsimi gelince pazarlar taptaze meyvelerle dolar. Teyzem her hafta pazara gider; taze √ºz√ºm, kƒ±rmƒ±zƒ± elma ve sulu karpuz alƒ±r. Buz gibi meyveleri yemek, sƒ±cak havada insanƒ± √ßok rahatlatƒ±r. √ñzellikle haziran ayƒ±nda √ßƒ±kan kirazlarƒ±n lezzeti bir ba≈üka g√ºzeldir.",
                icon: "sun"
            },
            {
                id: "s7",
                title: "7. Zeki‚Äônin Satran√ß Ma√ßƒ±",
                text: "Zeki, okulun satran√ß turnuvasƒ±na hazƒ±rlandƒ±. Rakibi Oƒüuz, √ßok zorlu bir oyuncuydu. Ma√ß boyunca ikisi de hamlelerini dikkatlice d√º≈ü√ºnd√º. Zeki, vezirini ustaca kullanarak rakibini mat etti. Arkada≈ülarƒ± onu alkƒ±≈ülarken Zeki, zafer kazanmanƒ±n verdiƒüi gururla g√ºl√ºmsedi.",
                icon: "chess"
            }
        ];

        // --- STORAGE & STATE (√áOKLU KULLANICI Sƒ∞STEMƒ∞) ---
        const Storage = {
            get: (key) => { try { return localStorage.getItem(key); } catch (e) { return null; } },
            set: (key, val) => { try { localStorage.setItem(key, val); } catch (e) { } },
            remove: (key) => { try { localStorage.removeItem(key); } catch (e) { } }
        };

        let state = {
            name: "",
            completed: []
        };

        let currentActiveDay = null;
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        // --- INIT ---
        window.onload = function() {
            document.getElementById('login-screen').classList.remove('hidden');
            const lastUser = Storage.get('cs_last_user');
            if(lastUser) {
                document.getElementById('player-name').value = lastUser;
            }
        };

        function saveState() {
            if(!state.name) return;
            const key = `cs_user_${state.name.trim().toLowerCase()}`;
            Storage.set(key, JSON.stringify(state));
            Storage.set('cs_last_user', state.name);
        }

        function resetProgress() {
            if(confirm("Mevcut ajanƒ±n ilerlemesini silip √ßƒ±kƒ±≈ü yapmak istiyor musun? (Bu i≈ülem geri alƒ±namaz)")) {
                const cleanName = state.name.trim().toLowerCase();
                const key = `cs_user_${cleanName}`;
                const welcomeKey = `cs_welcome_seen_${cleanName}`;
                
                Storage.remove(key);
                Storage.remove(welcomeKey);
                location.reload();
            }
        }

        // --- GAME LOGIC ---
        function startGame() {
            const nameInput = document.getElementById('player-name').value;

            if(!nameInput.trim()) {
                alert("L√ºtfen Operat√∂r Adƒ±nƒ± gir!");
                return;
            }

            const cleanName = nameInput.trim();
            const userKey = `cs_user_${cleanName.toLowerCase()}`;
            const savedData = Storage.get(userKey);
            
            // Verileri y√ºkle
            if(savedData) {
                try {
                    state = JSON.parse(savedData);
                } catch(e) { console.error(e); }
            } else {
                state = {
                    name: cleanName,
                    completed: []
                };
            }
            saveState();

            // TEBRƒ∞K MESAJI KONTROL√ú (Sadece 1 Kere)
            const welcomeKey = `cs_welcome_seen_${cleanName.toLowerCase()}`;
            const hasSeenWelcome = Storage.get(welcomeKey);

            if (!hasSeenWelcome) {
                // Modalƒ± Hazƒ±rla
                document.getElementById('modal-agent-name').innerText = cleanName.toUpperCase();
                
                confetti({
                    particleCount: 200,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                
                const modal = document.getElementById('welcome-modal');
                modal.classList.remove('hidden');
                setTimeout(() => { modal.classList.add('active'); }, 10);

                // G√∂r√ºld√º olarak i≈üaretle
                Storage.set(welcomeKey, 'true');
            } else {
                // Direkt Dashboard'a git
                showDashboard();
            }
        }

        function closeWelcomeModal() {
            const modal = document.getElementById('welcome-modal');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.add('hidden');
                showDashboard();
            }, 300);
        }

        function showDashboard() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-dashboard').classList.remove('hidden');
            document.getElementById('display-name').innerText = state.name;
            renderAllStories();
            updateXP();
        }

        function renderAllStories() {
            const container = document.getElementById('content-area');
            let html = '';
            
            // Sƒ±radaki ilk yapƒ±lmamƒ±≈ü g√∂revi bul
            let nextMissionId = null;
            for(let i=0; i<storyList.length; i++) {
                if(!state.completed.includes(storyList[i].id)) {
                    nextMissionId = storyList[i].id;
                    break;
                }
            }

            storyList.forEach(task => {
                const isChecked = state.completed.includes(task.id);
                const isNext = (task.id === nextMissionId);
                
                let cardStyle = isChecked 
                    ? "bg-green-900/40 border-l-4 border-green-500 opacity-70" 
                    : isNext
                        ? "current-mission"
                        : "bg-[#151921] border-l-4 border-gray-600";
                
                let iconColor = isChecked ? "text-green-500" : isNext ? "text-yellow-400" : "text-orange-500";
                let clickAction = `onclick="openStoryModal('${task.id}')"`;
                
                let badge = "";
                if(isNext) {
                    badge = `<span class="next-badge absolute right-4 top-4 bg-yellow-500 text-black text-[10px] font-bold px-2 py-1 rounded shadow-lg">SIRADAKƒ∞ HEDEF</span>`;
                } else if(isChecked) {
                    badge = `<span class="absolute right-4 top-4 text-green-500 text-lg"><i class="fas fa-check-circle"></i></span>`;
                }

                html += `
                    <div ${clickAction} class="level-card cursor-pointer p-4 flex items-center gap-4 ${cardStyle}">
                        <div class="w-12 h-12 flex items-center justify-center bg-black/50 rounded border border-gray-700 ${iconColor} text-xl">
                            <i class="fas fa-${task.icon}"></i>
                        </div>
                        <div class="flex-1 pr-10">
                            <div class="flex flex-col">
                                <h4 class="font-bold text-gray-200 hud-font uppercase tracking-wide text-lg ${isChecked ? 'line-through text-gray-500' : ''}">
                                    ${task.title}
                                </h4>
                                <p class="text-xs text-gray-400 font-mono mt-1 ${isChecked ? 'line-through' : ''}">
                                    ${task.text.substring(0, 60)}...
                                </p>
                            </div>
                        </div>
                        ${badge}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // --- SES KAYIT FONKSƒ∞YONLARI ---
        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            const text = document.getElementById('record-text');
            const playerArea = document.getElementById('audio-player-container');
            const player = document.getElementById('audio-player');
            const downloadLink = document.getElementById('download-link');

            if (!isRecording) {
                // KAYDI BA≈ûLAT
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.addEventListener("dataavailable", event => {
                        audioChunks.push(event.data);
                    });

                    mediaRecorder.addEventListener("stop", () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        player.src = audioUrl;
                        
                        // ƒ∞ndirme linkini ayarla
                        downloadLink.href = audioUrl;
                        downloadLink.download = `Aybars_Kayit_${new Date().toISOString().slice(0,10)}.mp3`;
                        
                        playerArea.classList.remove('hidden');
                        downloadLink.classList.remove('hidden'); // ƒ∞ndirme butonunu g√∂ster
                    });

                    mediaRecorder.start();
                    isRecording = true;
                    
                    btn.classList.remove('bg-red-900/50', 'text-red-200');
                    btn.classList.add('bg-red-600', 'text-white', 'recording-pulse');
                    text.innerText = "KAYDEDƒ∞Lƒ∞YOR... (DURDUR)";
                    
                    playerArea.classList.add('hidden');
                    downloadLink.classList.add('hidden');

                } catch (err) {
                    alert("Mikrofon eri≈üimine izin vermelisiniz!");
                    console.error(err);
                }
            } else {
                // KAYDI DURDUR
                mediaRecorder.stop();
                isRecording = false;
                
                btn.classList.remove('bg-red-600', 'text-white', 'recording-pulse');
                btn.classList.add('bg-red-900/50', 'text-red-200');
                text.innerText = "YENƒ∞DEN KAYDET";
            }
        }

        // --- MODAL LOGIC ---
        function openStoryModal(storyId) {
            currentActiveDay = storyId;
            const modal = document.getElementById('mission-modal');
            const title = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body-content');
            
            // Story verisini bul
            const data = storyList.find(s => s.id === storyId);

            // Kayƒ±t aray√ºz√ºn√º sƒ±fƒ±rla
            document.getElementById('audio-player-container').classList.add('hidden');
            document.getElementById('download-link').classList.add('hidden');
            document.getElementById('record-text').innerText = "SES KAYDI BA≈ûLAT";
            
            title.innerText = data.title;

            modalBody.innerHTML = `
                <div class="bg-gray-800 p-4 rounded border border-gray-600 text-gray-300 leading-relaxed text-sm h-64 overflow-y-auto">
                    ${data.text}
                </div>
                <div class="grid grid-cols-3 gap-4 bg-gray-900 p-4 rounded mt-4">
                    <div class="text-center">
                        <label class="block text-xs text-orange-500 font-bold mb-1">BA≈ûTA</label>
                        <input type="number" id="score-start" class="score-input w-full bg-black border-gray-700" min="1" max="5" placeholder="-">
                    </div>
                    <div class="text-center">
                        <label class="block text-xs text-orange-500 font-bold mb-1">ORTADA</label>
                        <input type="number" id="score-mid" class="score-input w-full bg-black border-gray-700" min="1" max="5" placeholder="-">
                    </div>
                    <div class="text-center">
                        <label class="block text-xs text-orange-500 font-bold mb-1">SONDA</label>
                        <input type="number" id="score-end" class="score-input w-full bg-black border-gray-700" min="1" max="5" placeholder="-">
                    </div>
                </div>
                <p class="text-xs text-center text-gray-500 mt-2">*Her pozisyon i√ßin 1-5 arasƒ± puan verin.</p>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.add('active'); }, 10);
        }

        function closeModal() {
            if(isRecording && mediaRecorder) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('record-btn').classList.remove('recording-pulse');
            }
            const modal = document.getElementById('mission-modal');
            modal.classList.remove('active');
            setTimeout(() => { 
                modal.classList.add('hidden');
                currentActiveDay = null;
            }, 300);
        }

        function submitMissionReport(method) {
            if(!currentActiveDay) return;
            
            const data = storyList.find(s => s.id === currentActiveDay);
            const sStart = document.getElementById('score-start').value || "0";
            const sMid = document.getElementById('score-mid').value || "0";
            const sEnd = document.getElementById('score-end').value || "0";

            if (sStart === "0" && sMid === "0" && sEnd === "0") {
                 if(!confirm("Puan girmedin. Yine de g√∂ndermek istiyor musun?")) return;
            }

            let mailBody = `OPERAT√ñR: ${state.name}\n`;
            mailBody += `G√ñREV: ${data.title}\n`;
            mailBody += `TARƒ∞H: ${new Date().toLocaleDateString()}\n\n`;
            mailBody += `--- PUAN TABLOSU ---\n`;
            mailBody += `POZƒ∞SYON - BA≈ûTA:  [ ${sStart} / 5 ]\n`;
            mailBody += `POZƒ∞SYON - ORTADA: [ ${sMid} / 5 ]\n`;
            mailBody += `POZƒ∞SYON - SONDA:  [ ${sEnd} / 5 ]\n`;
            mailBody += `\n*NOT: Ses kaydƒ±nƒ± eklemeyi unutmayƒ±n!*`;

            const subject = `CS Operasyon Raporu: ${state.name} - ${data.title}`;

            alert("‚ö†Ô∏è Dƒ∞KKAT: Ses kaydƒ±nƒ± 'KAYDI ƒ∞NDƒ∞R' butonuyla indirdiyseniz, a√ßƒ±lacak olan mail ekranƒ±na dosyayƒ± eklemeyi unutmayƒ±n!");

            if (method === 'mailto') {
                 window.location.href = `mailto:mehmethanefibulduk@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(mailBody)}`;
            } else if (method === 'gmail') {
                 const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=mehmethanefibulduk@gmail.com&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(mailBody)}`;
                 window.open(gmailUrl, '_blank');
            }

            // G√∂revi tamamla
            if (!state.completed.includes(currentActiveDay)) {
                state.completed.push(currentActiveDay);
                confetti({ particleCount: 150, spread: 60, origin: { y: 0.7 } });
            }
            
            saveState();
            updateXP();
            closeModal();
            renderAllStories(); // Listeyi g√ºncelle
        }

        function updateXP() {
            const totalTasks = storyList.length;
            const completedCount = state.completed.length;
            const percent = Math.min(100, (completedCount / totalTasks) * 100);
            
            document.getElementById('xp-display').innerText = `${completedCount} / ${totalTasks}`;
            document.getElementById('xp-bar').style.width = `${percent}%`;
        }

    </script>
</body>
</html>
